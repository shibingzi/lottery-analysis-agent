# 彩票分析 Agent - 设计决策文档

**文档版本**: v1.0.0  
**创建日期**: 2026-02-07  
**状态**: 已确认，待开发

---

## 📋 项目定位

### 核心理念
> 彩票分析 Agent = 数据获取工具 + 统计分析器 + 娱乐号码生成器 + 教育宣传员

**绝对不等于**:
- ❌ 预测系统
- ❌ 投注建议
- ❌ 中奖保证

### 目标用户
- 对彩票数据感兴趣的娱乐用户
- 想了解历史开奖规律的好奇者
- 需要管理固定号码组合的守号用户
- 寻求随机号码生成的机选需求者

---

## 🏗️ 架构决策

### 技术架构：混合模式

```
┌─────────────────────────────────────────────────────────────┐
│                     用户交互层                               │
│                   (Claude Agent)                            │
└───────────────────────┬─────────────────────────────────────┘
                        │ 意图识别、任务调度
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                     业务逻辑层                               │
│              (Sub-agents: SSQ/DLT Analyst)                  │
│     • 双色球专项分析    • 大乐透专项分析                      │
└───────────────────────┬─────────────────────────────────────┘
                        │ 调用Skills执行任务
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                     工具能力层                               │
│                      (Skills)                               │
│  ┌─────────────────┬─────────────────┬─────────────────┐   │
│  │  Data Fetcher   │   Analyzer      │   Predictor     │   │
│  │  数据获取        │   统计分析       │   号码生成       │   │
│  └─────────────────┴─────────────────┴─────────────────┘   │
└───────────────────────┬─────────────────────────────────────┘
                        │ 数据读写
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                     数据持久层                               │
│              (Python Scripts + JSON Files)                  │
│     • 历史数据获取    • 数据验证    • 本地存储               │
└─────────────────────────────────────────────────────────────┘
```

**决策原因**: 兼顾AI的灵活性和Python的精确性，支持离线分析和数据持久化

---

## 📊 数据策略

### 数据源设计

| 数据源 | 用途 | 优先级 |
|--------|------|--------|
| 中国福彩官网 | 双色球权威数据 | P0 |
| 中国体彩官网 | 大乐透权威数据 | P0 |
| 第三方数据API | 备用/验证 | P1 |

### 历史数据规模

**确认**: 预置3年历史数据

**数据量估算**:
- 双色球：3年 ≈ 156期（每周3次）
- 大乐透：3年 ≈ 312期（每周3次）

**存储结构**:
```
data/
├── ssq/
│   ├── history.json          # 3年完整历史
│   ├── statistics.json       # 预计算统计
│   └── cache/
│       └── latest_fetch.json # 最新获取状态
├── dlt/
│   ├── history.json
│   ├── statistics.json
│   └── cache/
│       └── latest_fetch.json
└── shared/
    └── config.json           # 彩种配置
```

### 更新策略

**冷启动**:
1. 预置3年基础数据（JSON格式）
2. 首次运行时检查数据完整性
3. 提供历史数据爬取脚本用于补充

**增量更新**:
- 每次启动时检查最新开奖
- 只获取缺失的最新期数
- 双源验证确保准确性

---

## 🎯 彩种支持规划

### 首期支持（v1.0）

| 彩种 | 代码 | 规则 | 开奖频率 |
|------|------|------|----------|
| 双色球 | ssq | 6红球(1-33) + 1蓝球(1-16) | 周二、四、日 |
| 大乐透 | dlt | 5前区(1-35) + 2后区(1-12) | 周一、三、六 |

### 扩展设计（v2.0+）

```python
# lottery_config.json 预留扩展接口
{
  "lotteries": {
    "ssq": { /* 双色球配置 */ },
    "dlt": { /* 大乐透配置 */ },
    "pl3": { /* 排列3 - 预留 */ },
    "pl5": { /* 排列5 - 预留 */ },
    "qxc": { /* 七星彩 - 预留 */ }
  }
}
```

---

## 🧩 组件职责划分

### Skills（工具层）

#### 1. skill_lottery_data_fetcher
**职责**: 纯数据获取与存储

**功能**:
- 从多源获取最新开奖数据
- 验证数据完整性和准确性
- 更新本地JSON数据库
- 提供数据查询接口

**输入/输出**:
```
输入: 彩种代码、期号范围
输出: 开奖数据JSON或错误信息
```

#### 2. skill_lottery_analyzer
**职责**: 统计算法实现

**功能**:
- 热号/冷号统计（周期可配置）
- 遗漏值计算
- 奇偶比/大小比分析
- 连号/区间分布统计
- 和值/跨度计算

**输入/输出**:
```
输入: 历史数据、分析类型、周期参数
输出: 统计结果JSON
```

#### 3. skill_lottery_predictor
**职责**: 号码生成（娱乐性质）

**功能**:
- 纯随机号码生成
- 固定号码+随机填充
- 基础组合合理性检查

**⚠️ 重要约束**:
- 绝不使用"预测"、"推荐"等词汇
- 明确标注"娱乐性质"
- 每次生成附带随机性说明

### Sub-agents（业务层）

#### 1. subagent_ssq_analyst
**职责**: 双色球专项业务逻辑

**决策能力**:
- 判断是否需要更新数据
- 选择合适的分析周期
- 解读统计结果的业务含义
- 生成符合双色球规则的组合

#### 2. subagent_dlt_analyst
**职责**: 大乐透专项业务逻辑

**决策能力**:
- 类似SSQ analyst，但针对大乐透规则
- 前区/后区独立分析

### 主Agent（协调层）

**职责**:
- 用户意图识别（自然语言理解）
- 任务路由（分配给正确的Sub-agent）
- 结果整合与格式化
- **⚠️ 强制添加免责声明**

---

## 📈 报告系统

### 双模式设计

#### 模式A: Markdown快速预览

**使用场景**: 快速查看、命令行环境

**内容**:
- 文字表格展示统计数据
- ASCII简单图表
- 快速结论摘要

**优点**:
- 即时响应
- 无需浏览器
- 易于复制分享

#### 模式B: HTML完整报告

**使用场景**: 详细分析、可视化需求

**内容**:
- Chart.js 交互式图表
- shadcn/ui Zinc 深色主题
- 响应式布局

**技术栈**:
```html
<!-- CDN依赖 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shadcn/ui/dist/zinc-dark.css">
```

**输出示例**:
```
lottery_report_ssq_20260207.html
lottery_report_dlt_20260207.html
```

---

## 🛡️ 安全与合规设计

### 免责声明策略

**强制出现位置**:
1. 每次用户交互的回复末尾
2. HTML报告的顶部banner
3. 项目README的醒目位置
4. 启动脚本的帮助信息

**标准免责声明模板**:
```
⚠️ 重要提示：
• 彩票开奖是完全随机的独立事件
• 历史数据对未来开奖没有任何预测价值
• 以上分析仅供娱乐参考，不构成投注建议
• 请理性购彩，量力而行
```

### 内容红线

**绝对禁止**:
- ❌ 任何"预测中奖号码"的表述
- ❌ 声称某些号码"更容易中奖"
- ❌ 提供具体的投注建议
- ❌ 针对未成年人的服务

**必须做到**:
- ✅ 明确标注所有数据来源
- ✅ 标注数据查询时间
- ✅ 解释统计方法的局限性
- ✅ 提醒彩票的成瘾风险

---

## 🔧 固定号码分析设计

### 功能定义

用户指定部分号码（如守号、生日号），系统：
1. 分析这些号码的历史表现
2. 评估当前组合的合理性
3. **纯随机**生成剩余号码
4. 提供组合建议（娱乐性质）

### 算法策略（确认方案A）

```
固定号码分析 = 数据分析 + 纯随机填充 + 教育说明

步骤:
1. 分析固定号码的遗漏值、出现频率
2. 检查当前组合的奇偶比、大小比
3. 剩余号码完全随机选择（不参考冷热）
4. 生成3-5组完整组合
5. 每组附带说明："随机生成，中奖概率相同"
```

**示例输出**:
```
固定号码: 红球 07 18 25, 蓝球 14

号码状态:
• 07号: 遗漏3期，近100期出现15次
• 18号: 遗漏0期，上期刚开出
• ...

建议组合（娱乐）:
1. 07 18 25 12 30 33 + 14
   [随机生成，包含固定号码]
2. 07 18 25 03 11 29 + 14
   [随机生成，包含固定号码]

⚠️ 注意: 以上号码完全随机生成，中奖概率与任何其他号码相同
```

---

## 📅 开发阶段规划

### 第一阶段：基础架构
**周期**: Week 1
**目标**: 搭建可运行的基础框架

**任务**:
- [ ] 创建项目目录结构
- [ ] 编写skill_lottery_data_fetcher.md
- [ ] 编写fetch_lottery_data.py（基础版）
- [ ] 准备3年预置历史数据
- [ ] 编写基础配置文件

**交付物**:
- 可运行的数据获取脚本
- 预置的3年历史数据文件
- 基础Skill文档

### 第二阶段：核心分析
**周期**: Week 2
**目标**: 实现统计分析能力

**任务**:
- [ ] 编写skill_lottery_analyzer.md
- [ ] 编写analyze_history.py
- [ ] 实现所有统计指标计算
- [ ] 编写Sub-agents（SSQ/DLT）
- [ ] 集成测试

**交付物**:
- 完整的统计分析功能
- 双色球/大乐透专项Agent

### 第三阶段：报告生成
**周期**: Week 3
**目标**: 实现双模式报告系统

**任务**:
- [ ] 设计报告HTML模板
- [ ] 实现Markdown报告生成
- [ ] 实现HTML报告生成
- [ ] 集成Chart.js可视化
- [ ] 报告导出功能

**交付物**:
- 两种格式的报告生成能力
- 可视化图表支持

### 第四阶段：完善与发布
**周期**: Week 4
**目标**: 完整功能+文档

**任务**:
- [ ] 编写skill_lottery_predictor.md
- [ ] 实现号码生成器
- [ ] 完善所有文档
- [ ] 编写启动脚本
- [ ] 全面测试

**交付物**:
- 完整的v1.0版本
- 用户指南
- 启动脚本

---

## 📁 文件结构规划

```
lottery-analysis-agent/
│
├── .claude/                          # Claude Code 配置核心
│   ├── settings.json                 # 主配置文件
│   ├── prompts/
│   │   └── system_prompt.md          # 系统提示词
│   ├── skills/
│   │   ├── skill_lottery_data_fetcher.md    # ✅ 数据获取
│   │   ├── skill_lottery_analyzer.md        # ✅ 统计分析
│   │   └── skill_lottery_predictor.md       # ✅ 号码生成
│   ├── agents/
│   │   ├── subagent_ssq_analyst.md          # ✅ 双色球专家
│   │   └── subagent_dlt_analyst.md          # ✅ 大乐透专家
│   └── config/
│       └── lottery_config.json       # 彩种配置
│
├── scripts/                          # Python工具脚本
│   ├── fetch_lottery_data.py         # ✅ 数据获取主脚本
│   ├── analyze_history.py            # ✅ 历史数据分析
│   ├── generate_fixed_numbers.py     # ✅ 固定号码生成
│   └── setup.py                      # 环境初始化
│
├── data/                             # 数据存储
│   ├── ssq/                          # 双色球数据
│   │   ├── history.json              # ✅ 3年历史数据
│   │   ├── statistics.json           # 统计缓存
│   │   └── cache/
│   ├── dlt/                          # 大乐透数据
│   │   ├── history.json              # ✅ 3年历史数据
│   │   ├── statistics.json
│   │   └── cache/
│   └── shared/
│       └── config.json
│
├── templates/                        # 报告模板
│   ├── report_template.html          # ✅ HTML报告模板
│   └── styles.css                    # 样式文件
│
├── docs/                             # 文档
│   ├── 01-ARCHITECTURE.md            # ✅ 架构设计
│   ├── 02-DATA_SOURCES.md            # ✅ 数据源说明
│   ├── 03-ANALYSIS_METHODS.md        # ✅ 分析方法
│   ├── 04-DISCLAIMER.md              # ✅ 免责声明
│   ├── 05-DESIGN_DECISIONS.md        # ✅ 本文件
│   └── UPDATE_LOG.md                 # 更新日志
│
├── README.md                         # ✅ 项目说明
├── USER_GUIDE.md                     # ✅ 使用指南
├── start-lottery-agent.sh            # ✅ 启动脚本
├── start-lottery-agent.bat           # Windows启动脚本
└── .env.example                      # 环境变量示例
```

---

## 🤔 待决策事项

### 高优先级（开发前确定）

1. **预置历史数据格式**
   - 方案A: 从公开数据集导入（需找到可靠数据源）
   - 方案B: 首次运行时通过脚本批量获取
   - 方案C: 精简版预置（如最近100期），剩余通过增量获取

2. **错误处理策略**
   - 数据获取失败时：重试？使用缓存？报错？
   - 多源数据不一致时：如何决策？

3. **性能考虑**
   - 3年数据分析的性能预期（响应时间目标）
   - 是否需要预计算统计缓存？

### 低优先级（可开发中调整）

1. 报告的美观度级别
2. 启动脚本的交互设计
3. 日志记录的详细程度

---

## ✅ 确认清单

- [x] 技术架构：混合模式
- [x] 数据策略：预置3年 + 增量更新
- [x] 职责划分：Skill=工具, Agent=决策
- [x] 报告系统：Markdown + HTML双模式
- [x] 固定号码：纯随机 + 教育说明
- [x] 彩种范围：双色球 + 大乐透（可扩展）
- [x] 历史数据量：3年
- [x] 安全合规：强制免责声明
- [ ] 个人定制：暂不开发

---

## 📝 变更记录

| 日期 | 版本 | 变更内容 | 决策者 |
|------|------|----------|--------|
| 2026-02-07 | v1.0.0 | 初始设计确认 | 头脑风暴 |
| 2026-02-07 | v1.0.0 | 移除个人定制功能 | 需求变更 |

---

**文档状态**: 设计阶段已完成，待开发实施

**下一步**: 根据此设计文档创建详细的实施计划

# Lottery Data Fetcher Skill

## 描述

彩票数据获取专家。负责从官方数据源获取双色球(SSQ)和大乐透(DLT)的最新开奖数据，支持增量更新、数据验证和本地存储。

**⚠️ 重要声明**: 本技能仅用于获取公开的开奖数据，所有数据仅供娱乐参考。

---

## 能力

### 1. 数据获取
- 从官方渠道获取最新开奖结果
- 支持双色球和大乐透数据
- 自动增量更新历史数据

### 2. 数据验证
- 验证数据完整性
- 检查号码范围有效性
- 去重和异常数据处理

### 3. 数据存储
- JSON格式本地存储
- 按彩种分目录管理
- 支持数据备份

### 4. 数据查询
- 按最新期号查询
- 按指定期号查询
- 按日期范围查询

---

## 使用方法

### 命令格式

```
/fetch <lottery_type> [options]
```

### 参数说明

| 参数 | 说明 | 可选值 | 默认值 |
|------|------|--------|--------|
| `lottery_type` | 彩票类型 | `ssq`, `dlt`, `all` | 必填 |
| `--limit` | 获取条数 | 任意正整数 | 100 |
| `--update` | 仅更新新数据 | - | false |
| `--issue` | 指定获取某期 | 期号字符串 | - |

### 使用示例

**1. 获取双色球最近100期数据**
```
/fetch ssq
```

**2. 获取大乐透最近50期数据**
```
/fetch dlt --limit 50
```

**3. 仅更新新数据（增量更新）**
```
/fetch all --update
```

**4. 获取所有彩种数据**
```
/fetch all
```

---

## 工作流程

### 数据获取流程

```
1. 接收获取请求
   ↓
2. 验证参数和彩票类型
   ↓
3. 检查本地数据状态
   ├─ 获取最新期号
   └─ 计算需要获取的数据范围
   ↓
4. 从数据源获取数据
   ├─ 尝试官方API
   ├─ 备用数据源
   └─ 网页抓取（fallback）
   ↓
5. 数据验证
   ├─ 号码范围检查
   ├─ 数据完整性检查
   └─ 去重处理
   ↓
6. 保存到本地
   ↓
7. 返回结果报告
```

---

## 数据源

### 主要数据源

| 数据源 | 类型 | URL | 说明 |
|--------|------|-----|------|
| 中国福彩官网 | 官方网站 | http://www.cwl.gov.cn/ | 双色球官方数据 |
| 中国体彩官网 | 官方网站 | https://www.lottery.gov.cn/ | 大乐透官方数据 |
| 500彩票网 | 第三方 | https://www.500.com/ | 备用数据源 |

### 数据字段

**双色球数据字段:**
```json
{
  "lottery_type": "ssq",
  "issue": "2025023",
  "draw_date": "2025-03-02",
  "red_balls": [3, 7, 12, 18, 25, 30],
  "blue_ball": 14,
  "prize_info": {
    "jackpot": "5注",
    "jackpot_amount": "1000万元/注"
  }
}
```

**大乐透数据字段:**
```json
{
  "lottery_type": "dlt",
  "issue": "25023",
  "draw_date": "2025-03-01",
  "front_zone": [5, 12, 23, 28, 35],
  "back_zone": [3, 9],
  "prize_info": {
    "jackpot": "3注",
    "jackpot_amount": "1000万元/注"
  }
}
```

---

## 数据存储

### 目录结构

```
data/
├── ssq/
│   └── history.json       # 双色球历史数据
├── dlt/
│   └── history.json       # 大乐透历史数据
└── cache/
    └── last_update.json   # 最后更新时间记录
```

### 数据格式

**本地存储格式:**
```json
[
  {
    "lottery_type": "ssq",
    "issue": "2025023",
    "draw_date": "2025-03-02",
    "red_balls": [3, 7, 12, 18, 25, 30],
    "blue_ball": 14,
    "prize_info": {...}
  },
  ...
]
```

### 数据更新策略

1. **增量更新**: 只获取本地没有的新数据
2. **全量更新**: 重新获取所有历史数据
3. **定期更新**: 建议每天开奖后更新

---

## 输出格式

### 标准输出

```markdown
## 📥 数据获取结果

### 双色球
- ✅ 数据文件: data/ssq/history.json
- ✅ 新增记录: 5条
- ✅ 总计记录: 105条
- ✅ 最新期号: 2025023
- ✅ 最后更新: 2026-02-07 14:30:00

### 大乐透
- ✅ 数据文件: data/dlt/history.json
- ✅ 新增记录: 3条
- ✅ 总计记录: 103条
- ✅ 最新期号: 25023
- ✅ 最后更新: 2026-02-07 14:30:00

---
⚠️ **免责声明**: 数据仅供娱乐参考，不构成投注建议。
```

---

## 错误处理

### 常见错误

| 错误类型 | 错误信息 | 处理方式 |
|---------|---------|---------|
| 网络连接失败 | "无法连接到数据源" | 检查网络，使用本地缓存 |
| 数据源不可用 | "数据源返回错误" | 切换到备用数据源 |
| 数据格式错误 | "无法解析返回数据" | 记录错误，跳过该条 |
| 存储失败 | "无法写入数据文件" | 检查磁盘空间，权限 |

---

## 技术规范

### 性能要求

- 单次获取100条数据: < 5秒
- 数据验证: < 1秒
- 本地存储: < 0.5秒

### 数据验证规则

**双色球:**
- 红球: 6个号码，范围1-33，不重复
- 蓝球: 1个号码，范围1-16

**大乐透:**
- 前区: 5个号码，范围1-35，不重复
- 后区: 2个号码，范围1-12，不重复

---

## 安全与伦理

### 数据来源合规

- 仅获取公开的官方开奖数据
- 不涉及任何个人账户信息
- 不用于商业用途

### 使用声明

- 数据获取频率合理，不造成服务器负担
- 数据仅供个人娱乐使用
- 遵守各数据源的使用条款

---

**版本**: v1.0.0  
**最后更新**: 2026-02-07
